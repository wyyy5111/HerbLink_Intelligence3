(() => {
  const platformMeta = {
    farmer: {
      key: "farmer",
      name: "农户端",
      short: "FARMER",
      description: "智慧生产与经营协同中枢"
    },
    client: {
      key: "client",
      name: "客户端",
      short: "CLIENT",
      description: "可信消费与交易增长中台"
    }
  };

  const governmentContacts = [
    {
      region: "陕西省药监局",
      phone: "029-12345678",
      email: "sxyaojian@agency.gov.cn",
      duty: "药材批次抽检与合规审计"
    },
    {
      region: "贵州省农业农村厅",
      phone: "0851-98765432",
      email: "gznync@agency.gov.cn",
      duty: "产区标准化种植监管"
    },
    {
      region: "四川省市场监督管理局",
      phone: "028-87654321",
      email: "scjg@agency.gov.cn",
      duty: "流通环节质量追溯"
    },
    {
      region: "云南省中药材产业专班",
      phone: "0871-45678901",
      email: "ynzyc@agency.gov.cn",
      duty: "重点产区协同服务"
    },
    {
      region: "甘肃省药品监督管理局",
      phone: "0931-66778899",
      email: "gsdrug@agency.gov.cn",
      duty: "质量风险处置联动"
    },
    {
      region: "安徽省农业农村厅",
      phone: "0551-88990011",
      email: "ahnync@agency.gov.cn",
      duty: "种植培训与技术督导"
    }
  ];

  const slugMap = {
    AI入口: "ai-entry",
    市场行情: "market",
    在线课程: "courses",
    查找: "search",
    首页: "dashboard",
    农场情况: "farm-status",
    "发布直播/作品": "live-studio",
    社区: "community",
    我的: "profile",
    简介: "profile-overview",
    物流: "logistics",
    收益: "revenue",
    历史: "history",
    一键找专家: "expert",
    创作者中心: "creator-center",
    设置: "settings",
    商城: "commerce",
    关注: "following",
    福利: "benefits",
    今日行情: "daily-market",
    拍照鉴真伪: "photo-auth",
    消息: "messages",
    认领农场: "adopted-farm",
    观看历史: "watch-history",
    我的钱包: "wallet",
    "各地政府+监管单位电话及邮箱": "regulatory-contacts",
    监管通讯录: "regulatory-contacts"
  };

  const requiredMenus = {
    farmer: {
      首页: ["AI入口", "市场行情", "在线课程", "查找", "首页", "农场情况", "发布直播/作品", "社区", "我的"],
      我的: ["简介", "物流", "收益", "历史", "一键找专家", "创作者中心", "设置"]
    },
    client: {
      首页: ["AI入口", "市场行情", "商城", "关注", "福利", "查找", "今日行情", "首页", "拍照鉴真伪", "消息", "我的"],
      我的: ["简介", "物流", "认领农场", "观看历史", "我的钱包", "设置", "各地政府+监管单位电话及邮箱"]
    }
  };

  const kpi = (label, value, trend) => ({ label, value, trend });

  const capability = (title, detail, input, output, risk, logs) => ({
    title,
    detail,
    input,
    output,
    risk,
    logs
  });

  const autoLogs = (moduleName, title) => [
    `接收 ${moduleName} 请求并完成参数标准化`,
    `${title} 规则链开始执行，写入过程审计日志`,
    `输出结果同步至双端界面与消息中心`
  ];

  const detailBlueprint = (platform, name) => {
    const pName = platformMeta[platform].name;

    switch (name) {
      case "AI入口":
        return {
          summary:
            platform === "farmer"
              ? "统一接入病虫害识别、农事问答、作业建议与经营预测，形成农户侧智能总入口。"
              : "统一接入鉴真伪、选品建议、交易咨询与消费问答，形成客户端智能服务入口。",
          scene:
            platform === "farmer"
              ? "农户拍照上传地块叶片，AI 自动识别风险并派发干预建议。"
              : "消费者拍照上传药材，AI 自动输出真伪评估与购买建议。",
          kpis:
            platform === "farmer"
              ? [kpi("识别准确率", "98.7%", "+1.8%"), kpi("建议采纳率", "82%", "+6.2%"), kpi("预警提前", "19小时", "+4小时")]
              : [kpi("识别准确率", "98.9%", "+2.0%"), kpi("咨询转化率", "31%", "+5.3%"), kpi("平均响应", "280ms", "-18ms")],
          capabilities: [
            capability(
              "多模态识别",
              "支持图像、文本、语音联合识别，自动映射到药材标准库。",
              ["上传图片/语音", "输入识别意图", "选择业务场景"],
              ["返回识别结论", "生成置信度评分", "给出下一步建议"],
              "低置信度样本自动转人工复核队列。",
              autoLogs(name, "多模态识别")
            ),
            capability(
              "AI问答",
              "围绕种植、加工、购买、履约提供多轮上下文问答。",
              ["用户问题", "角色信息", "历史会话"],
              ["结构化回答", "可执行建议", "关联操作入口"],
              "敏感问题触发合规词库过滤与降级回答。",
              autoLogs(name, "AI问答")
            ),
            capability(
              "自动工单派发",
              "识别高风险事件后自动触发工单与消息通知。",
              ["风险等级", "业务类型", "责任人策略"],
              ["生成工单", "推送通知", "回写处理状态"],
              "高风险工单必须二次确认后方可关闭。",
              autoLogs(name, "自动工单派发")
            )
          ],
          workflow: ["接收用户请求", "调用识别/推理模型", "输出建议并落地操作", "记录全链审计日志"]
        };

      case "市场行情":
        return {
          summary: "覆盖价格、成交量、产区热力与波动预警，支持双端联动决策。",
          scene: "运营人员切换周期查看川贝母价格并触发波动预警通知。",
          kpis: [kpi("覆盖产区", "180+", "+12"), kpi("采样频率", "5分钟/次", "实时"), kpi("预警命中", "93%", "+3.1%")],
          capabilities: [
            capability(
              "价格趋势雷达",
              "按日、周、月维度展示主力品种价格曲线。",
              ["选择品类", "选择时间窗口", "选择产区"],
              ["输出趋势图", "计算均值与波动", "标注异常点"],
              "异常波动自动触发二级审核。",
              autoLogs(name, "价格趋势雷达")
            ),
            capability(
              "产区热力排行",
              "按成交额、涨跌幅和库存周转排序产区。",
              ["产区数据流", "成交记录", "库存快照"],
              ["输出热力榜", "推送重点产区", "更新作战看板"],
              "数据缺失时自动回落到最近可信快照。",
              autoLogs(name, "产区热力排行")
            ),
            capability(
              "预警策略中心",
              "支持自定义涨跌阈值与订阅人群。",
              ["设定阈值", "选择订阅对象", "定义触发规则"],
              ["发送短信/站内信", "生成预警记录", "触发处置流程"],
              "同一事件 30 分钟内自动去重。",
              autoLogs(name, "预警策略中心")
            )
          ],
          workflow: ["采集行情数据", "计算趋势与波动", "触发策略预警", "回写监控与日志"]
        };

      case "在线课程":
        return {
          summary: "构建农事课程、合规课程和经营课程的阶梯式成长体系。",
          scene: "新入驻农户领取标准化种植课程并完成阶段测评。",
          kpis: [kpi("课程数量", "500+", "+38"), kpi("完课率", "74%", "+8.4%"), kpi("测评通过率", "89%", "+3.2%")],
          capabilities: [
            capability(
              "课程路径编排",
              "根据用户画像自动推荐学习路线。",
              ["用户角色", "地块类型", "历史成绩"],
              ["生成课程路径", "输出优先级", "同步学习计划"],
              "低完成度自动触发学习提醒。",
              autoLogs(name, "课程路径编排")
            ),
            capability(
              "实操回放中心",
              "提供关键农事操作的短视频回放。",
              ["课程 ID", "操作主题", "播放设备"],
              ["返回视频流", "记录观看进度", "同步历史记录"],
              "异常播放链路自动切换 CDN 节点。",
              autoLogs(name, "实操回放中心")
            ),
            capability(
              "考核认证",
              "课程结束后自动发起测评并归档认证。",
              ["考试题库", "学员答卷", "评分规则"],
              ["输出成绩", "生成证书", "回写档案"],
              "成绩异常波动需人工复核。",
              autoLogs(name, "考核认证")
            )
          ],
          workflow: ["分发课程", "跟踪学习行为", "发起测评", "归档结果并驱动后续推荐"]
        };

      case "查找":
        return {
          summary: "统一检索药材、订单、课程、地块、内容与服务入口，实现一步直达。",
          scene: "用户输入关键词“川贝母预售”，系统返回交易、课程与资讯混合结果。",
          kpis: [kpi("平均检索耗时", "220ms", "-20ms"), kpi("命中率", "96%", "+2.3%"), kpi("点击转化", "42%", "+4.1%")],
          capabilities: [
            capability(
              "全局语义检索",
              "支持同义词、拼音和业务别名识别。",
              ["关键词", "用户身份", "上下文"],
              ["返回多源结果", "分组展示", "高亮命中内容"],
              "敏感词自动屏蔽并提示规范查询。",
              autoLogs(name, "全局语义检索")
            ),
            capability(
              "联想推荐",
              "根据行为轨迹给出检索建议。",
              ["历史搜索", "近期点击", "热门词表"],
              ["输出联想词", "预加载结果", "提升查询效率"],
              "低相关建议自动降权。",
              autoLogs(name, "联想推荐")
            ),
            capability(
              "结果直达",
              "允许一键跳转至目标业务流程。",
              ["目标实体 ID", "跳转规则", "权限信息"],
              ["校验权限", "跳转详情页", "记录访问日志"],
              "越权访问立即阻断并上报。",
              autoLogs(name, "结果直达")
            )
          ],
          workflow: ["接收查询", "聚合多源索引", "排序与推荐", "权限校验后直达"]
        };

      case "首页":
        return {
          summary:
            platform === "farmer"
              ? "农户端首页聚合任务提醒、农场状态、预售进度与快捷操作。"
              : "客户端首页聚合行情快讯、推荐商品、福利活动与服务入口。",
          scene:
            platform === "farmer"
              ? "清晨打开首页即查看当天地块预警、待办任务与订单履约节点。"
              : "用户打开首页即查看今日行情、推荐商品和专属福利任务。",
          kpis:
            platform === "farmer"
              ? [kpi("任务准时率", "91%", "+5.6%"), kpi("首页停留时长", "7.8 分钟", "+1.2 分钟"), kpi("快捷操作使用率", "64%", "+8.0%")]
              : [kpi("首页转化率", "18.6%", "+2.1%"), kpi("推荐点击率", "33%", "+4.5%"), kpi("活动参与率", "41%", "+3.9%")],
          capabilities: [
            capability(
              "首屏驾驶舱",
              "展示最关键的业务状态与待处理事项。",
              ["用户画像", "业务指标", "提醒策略"],
              ["首屏模块布局", "生成优先提醒", "同步快捷入口"],
              "关键提醒不可被低优先级内容覆盖。",
              autoLogs(name, "首屏驾驶舱")
            ),
            capability(
              "任务提醒中心",
              "按紧急程度推送任务并支持快速处理。",
              ["任务池", "截止时间", "风险分级"],
              ["分层提醒", "一键处理", "回写结果"],
              "超时任务自动升级到运营看板。",
              autoLogs(name, "任务提醒中心")
            ),
            capability(
              "快捷入口编排",
              "根据近期行为动态调整入口优先级。",
              ["点击热度", "业务阶段", "配置规则"],
              ["更新入口排序", "展示常用功能", "记录改版效果"],
              "入口改版需通过灰度策略后全量发布。",
              autoLogs(name, "快捷入口编排")
            )
          ],
          workflow: ["聚合核心数据", "计算首页优先级", "渲染模块布局", "持续监控转化效果"]
        };

      case "农场情况":
        return {
          summary: "覆盖地块、墒情、病虫害、设备与作业计划的实时监控模块。",
          scene: "系统发现 3 号地块湿度异常，自动触发喷灌建议并推送负责人。",
          kpis: [kpi("在线地块", "6,218", "+132"), kpi("预警响应时长", "12 分钟", "-3 分钟"), kpi("异常闭环率", "97%", "+2.5%")],
          capabilities: [
            capability(
              "地块监测面板",
              "实时展示湿度、温度、光照与生长指标。",
              ["传感器数据", "地块档案", "监测阈值"],
              ["状态评分", "异常标记", "监测曲线"],
              "离线设备自动触发巡检任务。",
              autoLogs(name, "地块监测面板")
            ),
            capability(
              "病虫害预警",
              "通过图像与环境数据综合判定风险等级。",
              ["田间图像", "气象数据", "历史病例"],
              ["风险等级", "处置建议", "专家会诊建议"],
              "高风险样本自动升级专家复核。",
              autoLogs(name, "病虫害预警")
            ),
            capability(
              "作业排程",
              "围绕采收、施肥、灌溉自动生成任务排期。",
              ["农事计划", "地块状态", "人力资源"],
              ["排程日历", "责任分配", "提醒通知"],
              "冲突排程自动重算并提示管理者。",
              autoLogs(name, "作业排程")
            )
          ],
          workflow: ["数据采集", "风险识别", "任务排程", "执行回执与复盘"]
        };

      case "发布直播/作品":
        return {
          summary: "支持农户端内容发布、直播排班、成交归因与私域转化。",
          scene: "农户创建“当归采收直播”，自动绑定商品并生成成交归因链路。",
          kpis: [kpi("周直播场次", "1,280", "+16%"), kpi("内容转化率", "28%", "+4.2%"), kpi("复购贡献", "19%", "+2.8%")],
          capabilities: [
            capability(
              "直播排班系统",
              "配置直播主题、时段、货盘与互动脚本。",
              ["直播主题", "开播时间", "商品清单"],
              ["生成排班", "同步提醒", "开播前检查"],
              "货盘库存低于阈值自动预警。",
              autoLogs(name, "直播排班系统")
            ),
            capability(
              "作品发布引擎",
              "支持短视频图文发布与标签策略。",
              ["素材文件", "标签策略", "发布对象"],
              ["生成内容卡", "分发推荐流", "回收互动数据"],
              "违规素材自动拦截并待审。",
              autoLogs(name, "作品发布引擎")
            ),
            capability(
              "成交归因看板",
              "统计内容触达、点击、成交全链指标。",
              ["内容行为流", "交易订单", "用户标签"],
              ["输出归因模型", "生成转化报表", "推送优化建议"],
              "异常成交自动触发风控核查。",
              autoLogs(name, "成交归因看板")
            )
          ],
          workflow: ["内容创建", "审核分发", "交易归因", "复盘优化"]
        };

      case "社区":
        return {
          summary: "构建产区交流、经验问答、任务协作与知识沉淀社区。",
          scene: "农户发布“黄芪病斑处理”帖子，系统自动匹配专家答复。",
          kpis: [kpi("日活用户", "82,000", "+9.4%"), kpi("问题解决率", "88%", "+3.7%"), kpi("平均响应", "14 分钟", "-2 分钟")],
          capabilities: [
            capability(
              "问答广场",
              "支持图文提问、答疑投票与最佳答案沉淀。",
              ["问题内容", "图片证据", "标签分类"],
              ["分发问答流", "匹配答主", "沉淀知识卡片"],
              "争议回答自动触发二次审核。",
              autoLogs(name, "问答广场")
            ),
            capability(
              "产区圈层",
              "按区域建立圈子并共享市场与作业信息。",
              ["区域信息", "成员关系", "动态内容"],
              ["圈层动态", "热门话题", "通知提醒"],
              "敏感信息自动打码处理。",
              autoLogs(name, "产区圈层")
            ),
            capability(
              "协作任务",
              "把社区问题转化为可执行任务。",
              ["问题工单", "负责人", "时间节点"],
              ["生成任务", "跟踪进展", "输出结果"],
              "超时任务自动升级运营督办。",
              autoLogs(name, "协作任务")
            )
          ],
          workflow: ["发布问题", "专家/社群响应", "任务化处理", "知识沉淀"]
        };

      case "我的":
        return {
          summary:
            platform === "farmer"
              ? "农户个人中心整合经营档案、收益数据、专家协作与账户设置。"
              : "客户端个人中心整合消费档案、订单物流、钱包资产与服务入口。",
          scene:
            platform === "farmer"
              ? "农户进入我的中心查看收益、历史作业与专家工单。"
              : "用户进入我的中心查看订单物流、钱包余额与农场认领权益。",
          kpis:
            platform === "farmer"
              ? [kpi("中心访问率", "72%", "+7.3%"), kpi("服务响应时长", "9 分钟", "-1.5 分钟"), kpi("问题闭环率", "95%", "+2.2%")]
              : [kpi("中心访问率", "69%", "+6.9%"), kpi("售后处理时长", "11 分钟", "-2 分钟"), kpi("权益领取率", "58%", "+5.1%")],
          capabilities: [
            capability(
              "资产总览",
              "集中展示账户信息、订单状态与服务权益。",
              ["用户身份", "资产数据", "服务状态"],
              ["生成总览卡片", "展示快捷入口", "更新提醒角标"],
              "敏感资产信息默认脱敏展示。",
              autoLogs(name, "资产总览")
            ),
            capability(
              "服务入口聚合",
              "把核心服务入口按优先级聚合。",
              ["服务配置", "用户偏好", "历史使用"],
              ["入口编排", "推荐排序", "点击回流"],
              "低可用服务入口自动下线。",
              autoLogs(name, "服务入口聚合")
            ),
            capability(
              "履约与通知中心",
              "汇总订单、物流、售后与系统通知。",
              ["订单状态", "物流节点", "消息记录"],
              ["统一消息流", "状态跟踪", "异常提醒"],
              "关键消息支持强提醒与回执确认。",
              autoLogs(name, "履约与通知中心")
            )
          ],
          workflow: ["聚合账户信息", "编排服务入口", "推送提醒", "形成闭环记录"]
        };

      case "简介":
        return {
          summary: "展示用户基本档案、认证信息、角色标签与可信等级。",
          scene: "审核人员在简介页核对农户认证与经营资质信息。",
          kpis: [kpi("档案完整度", "98%", "+1.9%"), kpi("认证通过率", "94%", "+2.7%"), kpi("信息更新时效", "T+0", "稳定")],
          capabilities: [
            capability(
              "档案卡片",
              "统一展示头像、身份、角色标签和业务规模。",
              ["用户主档", "角色信息", "标签策略"],
              ["渲染档案卡", "输出可信等级", "展示补全建议"],
              "缺失关键字段时禁止提交认证。",
              autoLogs(name, "档案卡片")
            ),
            capability(
              "认证信息管理",
              "支持实名、资质、经营许可证管理。",
              ["认证材料", "审核规则", "状态机"],
              ["更新认证状态", "记录审批意见", "推送结果"],
              "证件过期自动触发续期提醒。",
              autoLogs(name, "认证信息管理")
            ),
            capability(
              "经营标签",
              "根据行为与经营数据自动生成标签。",
              ["交易行为", "履约记录", "内容活跃度"],
              ["输出标签集合", "写入推荐引擎", "驱动权益策略"],
              "标签异常变动需二次确认。",
              autoLogs(name, "经营标签")
            )
          ],
          workflow: ["拉取档案", "校验证照", "更新标签", "回写可信评级"]
        };

      case "物流":
        return {
          summary: "覆盖发货、在途、签收、异常与售后的全程可视化物流链路。",
          scene: "订单在途超时后，物流模块自动推送预警并触发补偿流程。",
          kpis: [kpi("准时履约率", "96%", "+2.2%"), kpi("异常处理时长", "26 分钟", "-5 分钟"), kpi("签收确认率", "99%", "+0.6%")],
          capabilities: [
            capability(
              "履约节点追踪",
              "追踪打包、出库、运输、签收全流程节点。",
              ["订单号", "物流单号", "节点回传"],
              ["节点时间轴", "状态标记", "异常提示"],
              "节点缺失 30 分钟自动告警。",
              autoLogs(name, "履约节点追踪")
            ),
            capability(
              "异常处理工单",
              "针对丢件、破损、超时生成处理工单。",
              ["异常类型", "责任归属", "处理策略"],
              ["派发工单", "跟踪处理", "记录闭环"],
              "赔付必须通过双人审批。",
              autoLogs(name, "异常处理工单")
            ),
            capability(
              "签收与评价回流",
              "签收后自动拉取评价并回写服务分。",
              ["签收状态", "评价内容", "订单标签"],
              ["更新服务评分", "触发售后回访", "优化配送策略"],
              "低评分订单自动加入重点回访池。",
              autoLogs(name, "签收与评价回流")
            )
          ],
          workflow: ["节点采集", "异常识别", "工单处置", "评价回流"]
        };

      case "收益":
        return {
          summary: "面向农户端的收益总账模块，提供收入、成本、回款与利润拆解。",
          scene: "农户查看本周预售回款与成本构成，调整下一轮备货策略。",
          kpis: [kpi("本月总收益", "¥2,480,000", "+12.8%"), kpi("回款周期", "6.2 天", "-1.1 天"), kpi("利润率", "28%", "+3.4%")],
          capabilities: [
            capability(
              "收益总账",
              "按订单、渠道、产区多维展示收益。",
              ["订单流水", "渠道数据", "结算规则"],
              ["生成收益看板", "输出渠道贡献", "推送预警"],
              "异常收益波动需触发财务复核。",
              autoLogs(name, "收益总账")
            ),
            capability(
              "成本拆解",
              "拆解人工、农资、物流、营销成本。",
              ["成本流水", "预算模板", "科目映射"],
              ["成本分布图", "超标提醒", "优化建议"],
              "超预算项目自动触发审批。",
              autoLogs(name, "成本拆解")
            ),
            capability(
              "回款预测",
              "基于订单状态预测未来 30 天回款。",
              ["订单进度", "历史回款", "合同条款"],
              ["回款曲线", "风险订单列表", "催收建议"],
              "高风险回款订单自动通知财务。",
              autoLogs(name, "回款预测")
            )
          ],
          workflow: ["汇聚流水", "计算收益成本", "生成预测", "触发风险提醒"]
        };

      case "历史":
        return {
          summary: "归档作业、交易、内容与服务历史记录，支持快速检索与复盘。",
          scene: "运营人员检索过去 90 天的履约异常记录并导出复盘报告。",
          kpis: [kpi("归档记录", "2,400 万+", "+6%"), kpi("检索耗时", "260ms", "-30ms"), kpi("复盘完成率", "87%", "+4.4%")],
          capabilities: [
            capability(
              "历史归档库",
              "按时间、模块、角色存储业务记录。",
              ["操作日志", "业务事件", "时间范围"],
              ["归档索引", "可视检索", "导出能力"],
              "高敏数据默认水印导出。",
              autoLogs(name, "历史归档库")
            ),
            capability(
              "复盘回放",
              "按事件链路回放关键过程。",
              ["事件 ID", "节点记录", "回放参数"],
              ["生成回放时间轴", "高亮异常节点", "输出结论"],
              "缺失关键节点时禁止生成结论。",
              autoLogs(name, "复盘回放")
            ),
            capability(
              "模板报表",
              "一键生成周报、月报与专题复盘。",
              ["报表模板", "统计范围", "指标配置"],
              ["导出报表", "发送订阅人", "归档报告"],
              "外发报表自动附加权限水印。",
              autoLogs(name, "模板报表")
            )
          ],
          workflow: ["收集历史数据", "按索引检索", "回放复盘", "生成报告"]
        };

      case "一键找专家":
        return {
          summary: "支持专家智能匹配、远程会诊、方案下发与执行跟踪。",
          scene: "农户对突发病害发起会诊请求，系统 2 分钟内匹配到区域专家。",
          kpis: [kpi("专家库规模", "2,300+", "+120"), kpi("平均匹配时长", "2.4 分钟", "-0.8 分钟"), kpi("方案执行率", "84%", "+5.2%")],
          capabilities: [
            capability(
              "专家智能匹配",
              "按病害类型、产区、时效自动匹配专家。",
              ["问题标签", "地理位置", "紧急等级"],
              ["输出专家列表", "推荐最优专家", "生成预约单"],
              "高紧急问题自动并发通知 3 位专家。",
              autoLogs(name, "专家智能匹配")
            ),
            capability(
              "远程会诊",
              "图文+语音+视频会诊一体化处理。",
              ["会诊材料", "会议时段", "参与角色"],
              ["会议链接", "会诊纪要", "处置建议"],
              "会诊记录需全程留痕。",
              autoLogs(name, "远程会诊")
            ),
            capability(
              "方案回执",
              "执行方案后回传结果并形成知识沉淀。",
              ["执行反馈", "现场图片", "结果评分"],
              ["更新工单", "沉淀案例", "触发复盘"],
              "未回执工单自动催办。",
              autoLogs(name, "方案回执")
            )
          ],
          workflow: ["发起请求", "匹配专家", "执行会诊", "回执沉淀"]
        };

      case "创作者中心":
        return {
          summary: "管理内容选题、排期、素材、投放和转化复盘的创作中枢。",
          scene: "主播创建 7 天内容计划并绑定直播货盘，自动生成执行清单。",
          kpis: [kpi("周更新频次", "4.6 次", "+1.2"), kpi("内容成交贡献", "23%", "+3.6%"), kpi("粉丝增长", "18%", "+2.4%")],
          capabilities: [
            capability(
              "选题策略",
              "基于热词和行情自动推荐选题。",
              ["热点词库", "品类数据", "账号画像"],
              ["选题建议", "脚本框架", "发布时间"],
              "低质量选题自动降权。",
              autoLogs(name, "选题策略")
            ),
            capability(
              "排期协同",
              "统一管理直播与内容排期冲突。",
              ["排期计划", "团队资源", "货盘状态"],
              ["输出排期表", "冲突预警", "任务分配"],
              "冲突排期必须确认后发布。",
              autoLogs(name, "排期协同")
            ),
            capability(
              "转化复盘",
              "内容触达、互动、成交全链路复盘。",
              ["曝光数据", "互动数据", "成交订单"],
              ["归因分析", "优化建议", "复盘报告"],
              "异常转化自动触发风控校验。",
              autoLogs(name, "转化复盘")
            )
          ],
          workflow: ["制定选题", "编排排期", "执行发布", "转化复盘"]
        };

      case "设置":
        return {
          summary: "管理账号安全、角色权限、通知偏好与隐私策略。",
          scene: "用户开启异地登录保护并配置高优先级消息强提醒。",
          kpis: [kpi("安全策略覆盖", "100%", "稳定"), kpi("异常登录拦截", "99.6%", "+0.4%"), kpi("通知触达成功", "98.2%", "+1.1%")],
          capabilities: [
            capability(
              "安全中心",
              "支持二步验证、设备管理、风险登录提醒。",
              ["账号信息", "设备指纹", "安全策略"],
              ["风险评估", "拦截策略", "安全通知"],
              "高风险登录必须二次验证。",
              autoLogs(name, "安全中心")
            ),
            capability(
              "通知偏好",
              "按业务类型配置通知渠道和频率。",
              ["消息类型", "渠道偏好", "接收时段"],
              ["推送策略", "免打扰规则", "触达统计"],
              "紧急通知不受免打扰影响。",
              autoLogs(name, "通知偏好")
            ),
            capability(
              "权限管理",
              "角色级数据访问与操作授权。",
              ["角色列表", "权限模板", "审计要求"],
              ["更新权限", "审计日志", "生效通知"],
              "高权限变更需双审批。",
              autoLogs(name, "权限管理")
            )
          ],
          workflow: ["加载安全策略", "更新权限与偏好", "应用策略", "记录审计日志"]
        };

      case "商城":
        return {
          summary: "构建商品管理、交易结算、售后工单与会员权益一体化商城。",
          scene: "用户下单后系统自动计算优惠、库存与履约策略。",
          kpis: [kpi("GMV", "¥18,600,000", "+15.3%"), kpi("支付转化率", "26%", "+2.9%"), kpi("售后满意度", "94%", "+1.8%")],
          capabilities: [
            capability(
              "商品编排",
              "按品类和场景组织商品卡片与活动标签。",
              ["商品池", "库存状态", "活动配置"],
              ["商品列表", "推荐位", "库存预警"],
              "库存低于阈值自动下架保护。",
              autoLogs(name, "商品编排")
            ),
            capability(
              "结算引擎",
              "支持优惠券、会员价、满减叠加计算。",
              ["购物车", "优惠规则", "用户权益"],
              ["计算应付金额", "锁定库存", "生成订单"],
              "价格异常订单自动拦截。",
              autoLogs(name, "结算引擎")
            ),
            capability(
              "售后工单",
              "退款、换货、质检争议统一处理。",
              ["售后申请", "证据材料", "规则策略"],
              ["派单处理", "状态跟踪", "回访评价"],
              "高价值售后需人工复核。",
              autoLogs(name, "售后工单")
            )
          ],
          workflow: ["商品展示", "下单结算", "履约配送", "售后闭环"]
        };

      case "关注":
        return {
          summary: "围绕品牌、达人、产区内容建立持续关注与复购触达机制。",
          scene: "用户关注“川贝母产区号”后自动收到直播和行情推送。",
          kpis: [kpi("关注转化率", "37%", "+4.1%"), kpi("内容触达率", "86%", "+2.5%"), kpi("复购贡献", "21%", "+3.0%")],
          capabilities: [
            capability(
              "关注流订阅",
              "整合关注对象的内容、商品和活动动态。",
              ["关注对象", "订阅规则", "推荐模型"],
              ["生成动态流", "推送提醒", "回收互动数据"],
              "重复消息自动去重。",
              autoLogs(name, "关注流订阅")
            ),
            capability(
              "兴趣分层",
              "按行为把用户划分为不同兴趣层。",
              ["点击行为", "购买记录", "停留时长"],
              ["兴趣标签", "内容策略", "触达频率"],
              "标签变化过快自动降权保护。",
              autoLogs(name, "兴趣分层")
            ),
            capability(
              "转化追踪",
              "跟踪关注行为带来的交易转化。",
              ["关注链路", "交易订单", "归因规则"],
              ["输出转化报表", "识别高价值关注对象", "优化运营策略"],
              "异常归因自动标记待核。",
              autoLogs(name, "转化追踪")
            )
          ],
          workflow: ["订阅关注对象", "内容触达", "行为回流", "优化策略"]
        };

      case "福利":
        return {
          summary: "管理优惠券、积分、任务激励和活动补贴的增长模块。",
          scene: "系统针对新用户发放首单券并追踪激活效果。",
          kpis: [kpi("券核销率", "62%", "+5.4%"), kpi("活动参与率", "48%", "+4.7%"), kpi("拉新贡献", "18%", "+2.6%")],
          capabilities: [
            capability(
              "券包中心",
              "统一管理领券、发券、核销与过期策略。",
              ["券模板", "用户分层", "活动规则"],
              ["发放券包", "核销统计", "到期提醒"],
              "重复领券自动拦截。",
              autoLogs(name, "券包中心")
            ),
            capability(
              "任务激励",
              "通过签到、下单、分享发放奖励。",
              ["任务配置", "行为事件", "奖励策略"],
              ["任务进度", "奖励发放", "完成提醒"],
              "作弊行为触发风控扣回。",
              autoLogs(name, "任务激励")
            ),
            capability(
              "活动看板",
              "实时监控活动预算与转化效果。",
              ["活动数据", "预算限制", "转化目标"],
              ["消耗曲线", "ROI 报告", "优化建议"],
              "超预算时自动降频。",
              autoLogs(name, "活动看板")
            )
          ],
          workflow: ["配置福利策略", "发放与触达", "行为核销", "复盘 ROI"]
        };

      case "今日行情":
        return {
          summary: "形成每日重点品类行情晨报与事件快讯。",
          scene: "系统每日 09:00 自动生成“今日行情”并推送关注用户。",
          kpis: [kpi("日报触达", "120 万", "+8.2%"), kpi("阅读完成率", "61%", "+5.0%"), kpi("行情订阅数", "32 万", "+4.6%")],
          capabilities: [
            capability(
              "晨报生成",
              "自动汇总主要品类价格与涨跌榜。",
              ["前日行情", "品类池", "摘要模板"],
              ["生成日报", "推送订阅人", "归档日报"],
              "异常数据在发布前二次校验。",
              autoLogs(name, "晨报生成")
            ),
            capability(
              "事件快讯",
              "突发波动事件秒级插播。",
              ["波动事件", "订阅规则", "优先级"],
              ["站内快讯", "消息推送", "事件追踪"],
              "重复事件自动合并。",
              autoLogs(name, "事件快讯")
            ),
            capability(
              "价格订阅",
              "支持自定义品类与阈值订阅。",
              ["订阅品类", "阈值", "通知渠道"],
              ["触发提醒", "回写订阅历史", "展示命中率"],
              "订阅过多自动建议分组。",
              autoLogs(name, "价格订阅")
            )
          ],
          workflow: ["汇总行情", "生成晨报", "触达订阅", "事件追踪"]
        };

      case "拍照鉴真伪":
        return {
          summary: "面向客户端的核心能力，提供拍照识别、真伪评估与风险提示。",
          scene: "用户上传药材照片后，3 秒内返回鉴真伪报告和购买建议。",
          kpis: [kpi("报告生成时长", "3.1 秒", "-0.4 秒"), kpi("识别准确率", "98.9%", "+2.1%"), kpi("异常样本召回", "95%", "+1.7%")],
          capabilities: [
            capability(
              "拍摄引导",
              "实时提示对焦、光线和角度，提升识别质量。",
              ["实时画面", "质量规则", "引导模板"],
              ["拍摄评分", "优化提示", "合格样本"],
              "低质量图片禁止进入识别流程。",
              autoLogs(name, "拍摄引导")
            ),
            capability(
              "真伪评估",
              "调用模型输出真伪概率与风险说明。",
              ["样本图片", "药材模型", "特征库"],
              ["评估结论", "风险等级", "对比证据"],
              "低置信结果自动建议线下复检。",
              autoLogs(name, "真伪评估")
            ),
            capability(
              "可信凭证",
              "生成可分享的鉴定凭证与溯源链接。",
              ["鉴定结果", "批次信息", "用户授权"],
              ["凭证卡片", "溯源码", "分享链接"],
              "凭证分享默认隐去用户隐私。",
              autoLogs(name, "可信凭证")
            )
          ],
          workflow: ["引导拍摄", "模型识别", "生成报告", "输出凭证"]
        };

      case "消息":
        return {
          summary: "聚合系统通知、订单进度、活动提醒和客服会话。",
          scene: "订单状态变化后消息模块即时推送并更新未读角标。",
          kpis: [kpi("消息送达率", "99.2%", "+0.8%"), kpi("未读下降", "-21%", "优化"), kpi("客服响应", "2.8 分钟", "-0.6 分钟")],
          capabilities: [
            capability(
              "会话聚合",
              "统一聚合系统、客服、交易、活动消息。",
              ["消息源", "会话 ID", "用户偏好"],
              ["统一消息流", "按优先级排序", "更新角标"],
              "同类消息批量折叠。",
              autoLogs(name, "会话聚合")
            ),
            capability(
              "关键提醒",
              "针对订单异常或风险消息强提醒。",
              ["风险级别", "业务类型", "提醒策略"],
              ["强提醒弹窗", "短信兜底", "回执确认"],
              "关键提醒必须记录已读状态。",
              autoLogs(name, "关键提醒")
            ),
            capability(
              "消息归档",
              "支持按模块归档与快速检索。",
              ["消息时间", "模块标签", "关键词"],
              ["归档列表", "检索结果", "导出记录"],
              "涉隐私消息禁止批量导出。",
              autoLogs(name, "消息归档")
            )
          ],
          workflow: ["接收消息", "分类聚合", "触达提醒", "归档检索"]
        };

      case "认领农场":
        return {
          summary: "客户端认领农场模块，连接消费者与真实产地。",
          scene: "用户认领地块后可查看生长周期、采收进度和权益结算。",
          kpis: [kpi("认领地块", "62,000", "+7.5%"), kpi("权益履约率", "97%", "+1.9%"), kpi("复购贡献", "24%", "+3.1%")],
          capabilities: [
            capability(
              "地块认领",
              "展示可认领地块并支持权益购买。",
              ["地块池", "用户等级", "权益规则"],
              ["认领结果", "权益账本", "生长档案"],
              "地块库存超售自动拦截。",
              autoLogs(name, "地块认领")
            ),
            capability(
              "生长追踪",
              "按周期推送地块实况和农事记录。",
              ["地块监测", "农事日志", "订阅策略"],
              ["成长日历", "图文回执", "异常提醒"],
              "异常数据需人工核验后展示。",
              autoLogs(name, "生长追踪")
            ),
            capability(
              "权益结算",
              "采收后自动计算用户权益并发放。",
              ["采收重量", "权益比例", "结算规则"],
              ["权益清单", "发放记录", "售后入口"],
              "结算异常自动挂起待审。",
              autoLogs(name, "权益结算")
            )
          ],
          workflow: ["认领地块", "追踪成长", "采收结算", "权益发放"]
        };

      case "观看历史":
        return {
          summary: "记录直播、课程和内容观看轨迹，支持续看与收藏。",
          scene: "用户回到历史页继续观看上次中断的直播回放。",
          kpis: [kpi("续看成功率", "89%", "+4.3%"), kpi("历史回访率", "52%", "+3.8%"), kpi("收藏转化率", "27%", "+2.2%")],
          capabilities: [
            capability(
              "轨迹记录",
              "自动记录观看进度和停留节点。",
              ["播放行为", "内容 ID", "设备信息"],
              ["历史记录", "断点位置", "内容标签"],
              "跨端同步失败自动重试。",
              autoLogs(name, "轨迹记录")
            ),
            capability(
              "续看恢复",
              "支持一键回到上次观看位置。",
              ["历史断点", "播放源", "设备状态"],
              ["恢复进度", "推荐关联内容", "更新历史"],
              "失效播放源自动切换备用源。",
              autoLogs(name, "续看恢复")
            ),
            capability(
              "偏好学习",
              "基于历史内容训练推荐偏好。",
              ["观看行为", "互动行为", "内容标签"],
              ["更新兴趣画像", "推荐候选", "推送策略"],
              "推荐结果需通过内容合规过滤。",
              autoLogs(name, "偏好学习")
            )
          ],
          workflow: ["记录行为", "存储断点", "恢复续看", "优化推荐"]
        };

      case "我的钱包":
        return {
          summary: "管理余额、积分、优惠券、分账与提现的资金模块。",
          scene: "用户提现申请提交后自动完成风险评估和打款排队。",
          kpis: [kpi("余额账户规模", "¥12,800,000", "+9.2%"), kpi("提现成功率", "98.4%", "+0.9%"), kpi("风险拦截率", "99.1%", "+0.7%")],
          capabilities: [
            capability(
              "账户总览",
              "展示可用余额、冻结金额和积分资产。",
              ["账户流水", "冻结状态", "积分规则"],
              ["余额看板", "资产明细", "风险提示"],
              "异常余额变动自动冻结核查。",
              autoLogs(name, "账户总览")
            ),
            capability(
              "提现流程",
              "支持银行卡提现与进度追踪。",
              ["提现金额", "收款账户", "风险策略"],
              ["提现申请", "风控评分", "到账通知"],
              "高风险提现需人工复核。",
              autoLogs(name, "提现流程")
            ),
            capability(
              "账单归档",
              "提供按月导出与资金流向分析。",
              ["账单流水", "筛选条件", "导出规则"],
              ["账单报表", "资金流向图", "导出文件"],
              "导出账单必须进行身份校验。",
              autoLogs(name, "账单归档")
            )
          ],
          workflow: ["加载资产", "执行操作", "风控校验", "更新账单"]
        };

      case "各地政府+监管单位电话及邮箱":
      case "监管通讯录":
        return {
          summary: "整合各地政府与监管单位电话、邮箱与协同职责，支持快速联动。",
          scene: "发生批次异常时，系统按区域自动推荐对应监管联络人。",
          kpis: [kpi("联络单位", `${governmentContacts.length} 个`, "全量"), kpi("联动响应时长", "8 分钟", "-2 分钟"), kpi("应急闭环率", "96%", "+1.8%")],
          capabilities: [
            capability(
              "通讯录检索",
              "按省份、职责、事件类型检索监管单位。",
              ["地区", "事件类型", "关键词"],
              ["返回联络信息", "推荐主责单位", "生成联动清单"],
              "联络信息变更需双人校验后发布。",
              autoLogs(name, "通讯录检索")
            ),
            capability(
              "应急协同",
              "支持一键生成电话+邮件通知模板。",
              ["事件摘要", "单位列表", "模板配置"],
              ["电话清单", "邮件模板", "发送记录"],
              "高风险事件通知必须保留回执。",
              autoLogs(name, "应急协同")
            ),
            capability(
              "联动归档",
              "沉淀监管沟通记录与处置结论。",
              ["沟通记录", "附件材料", "处置结果"],
              ["归档编号", "复盘摘要", "审计日志"],
              "归档记录不可删除，仅可追加。",
              autoLogs(name, "联动归档")
            )
          ],
          workflow: ["检索单位", "生成通知", "完成联动", "归档记录"],
          contacts: governmentContacts
        };

      default:
        return {
          summary: `${pName}${name}模块，提供完整业务处理能力。`,
          scene: `${pName}${name}模块执行标准化业务流程并输出结果。`,
          kpis: [kpi("处理效率", "95%", "+2%"), kpi("任务完成", "92%", "+3%"), kpi("异常闭环", "97%", "+1%")],
          capabilities: [
            capability(
              `${name}流程编排`,
              `完成${name}核心流程配置和执行。`,
              ["业务参数", "角色权限", "处理规则"],
              ["流程结果", "状态更新", "通知反馈"],
              "流程异常自动降级。",
              autoLogs(name, `${name}流程编排`)
            )
          ],
          workflow: ["接收请求", "执行处理", "输出结果", "记录日志"]
        };
    }
  };

  const modules = [];

  Object.entries(requiredMenus).forEach(([platform, sections]) => {
    Object.entries(sections).forEach(([section, names]) => {
      names.forEach((name, idx) => {
        const sectionSlug = section === "首页" ? "home" : "mine";
        const nameSlug = slugMap[name];
        const key = `${platform}-${sectionSlug}-${nameSlug}`;
        const path = `/modules/${key}.html`;
        const detail = detailBlueprint(platform, name);

        modules.push({
          key,
          path,
          slug: key,
          platform,
          platformName: platformMeta[platform].name,
          section,
          name,
          order: idx,
          summary: detail.summary,
          scene: detail.scene,
          kpis: detail.kpis,
          capabilities: detail.capabilities,
          workflow: detail.workflow,
          contacts: detail.contacts || null
        });
      });
    });
  });

  const modulesByKey = modules.reduce((acc, item) => {
    acc[item.key] = item;
    return acc;
  }, {});

  const modulesByPlatform = modules.reduce((acc, item) => {
    if (!acc[item.platform]) {
      acc[item.platform] = [];
    }
    acc[item.platform].push(item);
    return acc;
  }, {});

  window.MenuData = {
    generatedAt: "2026-02-08",
    platformMeta,
    requiredMenus,
    governmentContacts,
    modules,
    modulesByKey,
    modulesByPlatform
  };
})();
